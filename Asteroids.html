<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Asteroids</title>
    <style></style>
</head>

<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script src="Ship.js"> </script> 
<script src="Asteroid.js"> </script> 
<script>
    const FPS = 75;
    const FRICTION = 0.7; // friction coefficient in space
    const SHIP_SIZE = 30;
    const TURN_SPEED = 360; // Turn speed in degrees per second
    const SHIP_MOMENTUM = 5; // acceletarion of the ship in pixels per second
    const ASTEROID_SIZE = 100;
    const ASTEROIDS_NUMBER = 30;
    const ASTEROIDS_JAG = 0.5; // jaggedness of the asteroid
    const ASTEROID_SPEED = 50; // max speed for asteroids
    const ASTEROID_VERTICES = 10; // max number of vertices for an asteroid

    /** @type {HTMLCanvasElement} */
    var canv = document.getElementById("gameCanvas");
    var context = canv.getContext("2d");

    
    ship = new Ship(canv.width / 2, canv.height / 2, SHIP_SIZE);

    // set up event handlers
    document.addEventListener("keydown", keyDown);
    document.addEventListener("keyup", keyUp);

    function keyDown(/** @type {KeyboadEvent} */ ev) {
        switch(ev.keyCode) {
            case 37: // Left arrow
                ship.rotation = TURN_SPEED / 180 * Math.PI / FPS;
                break;
            case 38: // Up arrow
                ship.boosting = true;
                break;
            case 39: // Right arrow
                ship.rotation = -TURN_SPEED / 180 * Math.PI / FPS;
                break;
        }
    }

    function keyUp(/** @type {KeyboadEvent} */ ev) {
        switch(ev.keyCode) {
            case 37: // Left arrow
                ship.rotation = 0;
                break;
            case 38: // Up arrow
                ship.boosting = false;
                break;
            case 39: // Right arrow
                ship.rotation = 0;
                break;
        }
    }


    var Asteroids = [];
    createAsteroidBelt();
    function createAsteroidBelt() {
        Asteroids = []
        var x, y;
        for (var i = 0; i < ASTEROIDS_NUMBER; i++) {
            do {
                x = Math.floor(Math.random() * canv.width);
                y = Math.floor(Math.random() * canv.height);
            } while (distanceBetweenPoints(ship.x, ship.y, x, y) < ASTEROID_SIZE * 2 + ship.radius);

            Asteroids.push(new Asteroid(x, y, ASTEROID_SIZE, ASTEROID_SPEED, ASTEROID_VERTICES, ASTEROIDS_JAG))
        }
    }

    function distanceBetweenPoints(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    }

    // set up game loop
    setInterval(update, 1000 / FPS);
    
    function update(){
        // draw space
        context.fillStyle = "black";
        context.fillRect(0,0,canv.width, canv.height);

        // ship
        ship.drawShip();
        ship.boostShip();
        ship.rotateShip();
        ship.moveShip();
        ship.reappearWhenOutOfCanvas();

        // asteroids
        for (var i = 0; i < Asteroids.length; i++){
            Asteroids[i].drawAsteroid();
            Asteroids[i].moveAsteroid();
            Asteroids[i].reappearWhenOutOfCanvas();
        }
 
        // centre dot 
        context.fillStyle = "red";
        context.fillRect(ship.x - 1, ship.y - 1, 2, 2);

    }
</script>
</body>

</html>